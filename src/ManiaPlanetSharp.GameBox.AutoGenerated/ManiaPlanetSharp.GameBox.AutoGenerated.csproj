<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net8.0-windows</TargetFramework>
  </PropertyGroup>

  <!--<PropertyGroup>
    <_TransformExe Condition="'$(VisualStudioVersion)' != ''">$(VsInstallRoot)\Common7\IDE\TextTransformCore.exe</_TransformExe>
  </PropertyGroup>

  <Target Name="TransformOnBuild" AfterTargets="BeforeBuild">
    <Error Text="Failed to find TextTransform.exe tool at '$(_TransformExe)." Condition="!Exists('$(_TransformExe)')"/>
    <ItemGroup>
        <_TextTransform Include="@(None)" Condition="'%(None.Generator)' == 'TextTemplatingFilePreprocessor' Or '%(None.Generator)' == 'TextTemplatingFileGenerator'" />
    </ItemGroup>
    <Exec Command="&quot;$(_TransformExe)&quot; &quot;$(SolutionDir)\ManiaPlanetSharp.GameBox.AutoGenerated\@(_TextTransform)&quot;" Condition="'%(Identity)' != ''"/>
</Target>-->

  <!--<Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
  <PropertyGroup>
    <TransformOnBuild>true</TransformOnBuild>
  </PropertyGroup>
  <Import Project="$(MSBuildExtensionsPath)\Microsoft\VisualStudio\v16.0\TextTemplating\Microsoft.TextTemplating.targets" />-->

  <!--<Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />-->
<!--<Import Project="$(MSBuildExtensionsPath)\Microsoft\VisualStudio\v16.0\TextTemplating\Microsoft.TextTemplating.targets" />-->
  
  <PropertyGroup>
    <TransformOnBuild>true</TransformOnBuild>
  </PropertyGroup>
  <PropertyGroup>
    <OverwriteReadOnlyOutputFiles>true</OverwriteReadOnlyOutputFiles>
  </PropertyGroup>
  <PropertyGroup>
    <TransformOutOfDateOnly>false</TransformOutOfDateOnly>
  </PropertyGroup>
  <PropertyGroup>
    <BeforeTransform>CustomPreTransform</BeforeTransform>
    <AfterTransform>CustomPostTransform</AfterTransform>
    <RunPostBuildEvent>Always</RunPostBuildEvent>
    <Nullable>enable</Nullable>
    <AllowUnsafeBlocks>True</AllowUnsafeBlocks>
  </PropertyGroup>
  <Target Name="CustomPreTransform">
    <Message Text="In CustomPreTransform..." Importance="High" />
  </Target>
  <Target Name="CustomPostTransform">
    <Message Text="In CustomPostTransform..." Importance="High" />
  </Target>
  <ItemGroup>
    <Compile Remove="Classes.cs" />
  </ItemGroup>
  <ItemGroup>
    <None Remove="Classes.tt" />
  </ItemGroup>

  <ItemGroup>
    <None Include="StructParsers.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>StructParsers.tt</DependentUpon>
    </None>
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="System.CodeDom" Version="8.0.0" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\ManiaPlanetSharp\ManiaPlanetSharp.csproj" />
  </ItemGroup>

  <ItemGroup>
    <Service Include="{508349b6-6b84-4df5-91f0-309beebad82d}" />
  </ItemGroup>

  <ItemGroup>
    <Compile Update="ChunkParsers.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>ChunkParsers.tt</DependentUpon>
    </Compile>
    <Compile Update="StructParsers.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>StructParsers.tt</DependentUpon>
    </Compile>
  </ItemGroup>

  <ItemGroup>
    <None Update="ChunkParsers.tt">
      <Generator>TextTemplatingFileGenerator</Generator>
      <LastGenOutput>ChunkParsers.cs</LastGenOutput>
    </None>
    <None Update="StructParsers.tt">
      <Generator>TextTemplatingFileGenerator</Generator>
      <LastGenOutput>StructParsers.cs</LastGenOutput>
    </None>
  </ItemGroup>

  <Target Name="PreBuild" BeforeTargets="PreBuildEvent">
    <Exec Command="cd &quot;$(VsInstallRoot)\Common7\IDE\&quot;&#xD;&#xA;echo Generating chunk parsers...&#xD;&#xA;TextTransformCore.exe -P &quot;$(ProjectDir)..\..\src&quot; &quot;$(ProjectDir)\ChunkParsers.tt&quot;&#xD;&#xA;echo Generating struct parsers...&#xD;&#xA;TextTransformCore.exe -P &quot;$(ProjectDir)..\..\src&quot; &quot;$(ProjectDir)\StructParsers.tt&quot;" />
  </Target>

</Project>
